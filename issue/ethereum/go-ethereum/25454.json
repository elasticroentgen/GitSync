{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/25454",
  "id": 1324154766,
  "node_id": "I_kwDOAOvK985O7P-O",
  "number": 25454,
  "title": "Need to prune Geth but not enough blocks",
  "user": {
    "login": "StraySnake",
    "id": 96312970,
    "node_id": "U_kgDOBb2eig",
    "avatar_url": "https://avatars.githubusercontent.com/u/96312970?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/StraySnake",
    "html_url": "https://github.com/StraySnake",
    "followers_url": "https://api.github.com/users/StraySnake/followers",
    "following_url": "https://api.github.com/users/StraySnake/following{/other_user}",
    "gists_url": "https://api.github.com/users/StraySnake/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/StraySnake/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/StraySnake/subscriptions",
    "organizations_url": "https://api.github.com/users/StraySnake/orgs",
    "repos_url": "https://api.github.com/users/StraySnake/repos",
    "events_url": "https://api.github.com/users/StraySnake/events{/privacy}",
    "received_events_url": "https://api.github.com/users/StraySnake/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-08-01T10:01:28Z",
  "updated_at": "2022-08-05T11:56:27Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Geth version: 1.10.21-stable\r\nOS & Version: Linux Ubuntu Server\r\n\r\nHi everyone, I need to prune my geth for prepared to the \"merge\" but the result from geth snapshot prune-state --datadir /my/data/dir I've a error \"Snaphot not old enough yet: need 128 more blocks\". but my chain is sync after shutdown geth.\r\n\r\nI've never prune geth so now the size of my chaindata are around 1.4TB (with 300GB of ancient).\r\n\r\n`$ sudo cat /etc/systemd/system/eth1.service \r\n......\r\nUser=goeth\r\nGroup=goeth\r\nExecStart       = /usr/bin/geth --cache=2048 --datadir /var/lib/goethereum --identity \"xxxx\" --http --http.api \"admin,db,eth,net,web3\" --http.port 8545 --http.addr \"0.0.0.0\" --authrpc.jwtsecret xxxxx`\r\n\r\n`$ sudo -u goeth geth --datadir /var/lib/goethereum snapshot prune-state\r\nINFO [08-01|11:52:45.130] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [08-01|11:52:45.132] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nINFO [08-01|11:52:45.140] Set global gas cap                       cap=50,000,000\r\nINFO [08-01|11:52:45.141] Allocated cache and file handles         database=/var/lib/goethereum/geth/chaindata cache=512.00MiB handles=524,288\r\nINFO [08-01|11:52:54.799] Opened ancient database                  database=/var/lib/goethereum/geth/chaindata/ancient readonly=false\r\nWARN [08-01|11:52:54.858] Snapshot maintenance disabled (syncing) \r\nINFO [08-01|11:52:55.002] Initialized state bloom                  size=2.00GiB\r\nERROR[08-01|11:53:03.572] Failed to prune state                    err=\"snapshot not old enough yet: need 128 more blocks\"\r\nsnapshot not old enough yet: need 128 more blocks`\r\n\r\n`$ sudo du -h /var/lib/goethereum/geth/chaindata/\r\n290G\t/var/lib/goethereum/geth/chaindata/ancient\r\n1.1T\t/var/lib/goethereum/geth/chaindata/`\r\n\r\nThanks",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1204801274",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25454#issuecomment-1204801274",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454",
    "id": 1204801274,
    "node_id": "IC_kwDOAOvK985Hz876",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-04T06:07:27Z",
    "updated_at": "2022-08-04T06:07:27Z",
    "author_association": "MEMBER",
    "body": "Snapshot is required for running pruning mechanism. Your node doesn't have enough snapshot layers.\r\n\r\nYou can just run the node for a while(a couple of minutes), then it should have more than 128 layers accumulated and then you can run this command.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1204801274/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1205062539",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25454#issuecomment-1205062539",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454",
    "id": 1205062539,
    "node_id": "IC_kwDOAOvK985H08uL",
    "user": {
      "login": "StraySnake",
      "id": 96312970,
      "node_id": "U_kgDOBb2eig",
      "avatar_url": "https://avatars.githubusercontent.com/u/96312970?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StraySnake",
      "html_url": "https://github.com/StraySnake",
      "followers_url": "https://api.github.com/users/StraySnake/followers",
      "following_url": "https://api.github.com/users/StraySnake/following{/other_user}",
      "gists_url": "https://api.github.com/users/StraySnake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StraySnake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StraySnake/subscriptions",
      "organizations_url": "https://api.github.com/users/StraySnake/orgs",
      "repos_url": "https://api.github.com/users/StraySnake/repos",
      "events_url": "https://api.github.com/users/StraySnake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StraySnake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-04T10:24:52Z",
    "updated_at": "2022-08-04T10:25:21Z",
    "author_association": "NONE",
    "body": "> Snapshot is required for running pruning mechanism. Your node doesn't have enough snapshot layers.\r\n> \r\n> You can just run the node for a while(a couple of minutes), then it should have more than 128 layers accumulated and then you can run this command.\r\n\r\nAfter each try I check if my chain is sync so normally I have my 128 blocks.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1205062539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1205382452",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25454#issuecomment-1205382452",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454",
    "id": 1205382452,
    "node_id": "IC_kwDOAOvK985H2K00",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-04T15:04:26Z",
    "updated_at": "2022-08-04T15:04:26Z",
    "author_association": "MEMBER",
    "body": "According to your log, it said `Snapshot maintenance disabled (syncing) `. Looks like your node is not synced yet. Can you share some latest logs?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1205382452/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1205508500",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25454#issuecomment-1205508500",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454",
    "id": 1205508500,
    "node_id": "IC_kwDOAOvK985H2pmU",
    "user": {
      "login": "StraySnake",
      "id": 96312970,
      "node_id": "U_kgDOBb2eig",
      "avatar_url": "https://avatars.githubusercontent.com/u/96312970?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StraySnake",
      "html_url": "https://github.com/StraySnake",
      "followers_url": "https://api.github.com/users/StraySnake/followers",
      "following_url": "https://api.github.com/users/StraySnake/following{/other_user}",
      "gists_url": "https://api.github.com/users/StraySnake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StraySnake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StraySnake/subscriptions",
      "organizations_url": "https://api.github.com/users/StraySnake/orgs",
      "repos_url": "https://api.github.com/users/StraySnake/repos",
      "events_url": "https://api.github.com/users/StraySnake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StraySnake/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-04T16:41:24Z",
    "updated_at": "2022-08-05T11:56:27Z",
    "author_association": "NONE",
    "body": "> According to your log, it said `Snapshot maintenance disabled (syncing) `. Looks like your node is not synced yet. Can you share some latest logs?\r\n\r\n```\r\nAug 04 18:37:57 eth-node1 geth[968641]: INFO [08-04|18:37:57.749] State heal in progress                   accounts=2,709,705@158.30MiB slots=634,847@48.19MiB codes=120,860@935.81MiB nodes=1,571,905,786@464.06GiB pending=176,545\r\nAug 04 18:38:06 eth-node1 geth[968641]: INFO [08-04|18:38:06.652] State heal in progress                   accounts=2,709,767@158.31MiB slots=634,867@48.19MiB codes=120,860@935.81MiB nodes=1,571,906,450@464.06GiB pending=177,593\r\nAug 04 18:38:16 eth-node1 geth[968641]: INFO [08-04|18:38:16.660] State heal in progress                   accounts=2,709,874@158.31MiB slots=634,932@48.20MiB codes=120,860@935.81MiB nodes=1,571,907,383@464.06GiB pending=178,442\r\nAug 04 18:38:24 eth-node1 geth[968641]: INFO [08-04|18:38:24.723] State heal in progress                   accounts=2,709,980@158.32MiB slots=634,945@48.20MiB codes=120,860@935.81MiB nodes=1,571,908,034@464.06GiB pending=179,936\r\nAug 04 18:38:28 eth-node1 geth[968641]: INFO [08-04|18:38:28.890] Imported new block headers               count=1    elapsed=43.432ms    number=15,276,995 hash=0044d4..935ecc age=1m26s\r\nAug 04 18:38:34 eth-node1 geth[968641]: INFO [08-04|18:38:34.137] State heal in progress                   accounts=2,710,503@158.35MiB slots=634,965@48.20MiB codes=120,860@935.81MiB nodes=1,571,909,272@464.06GiB pending=180,059\r\nAug 04 18:38:34 eth-node1 geth[968641]: INFO [08-04|18:38:34.934] Imported new block headers               count=1    elapsed=27.443ms    number=15,276,996 hash=98bff4..9a6b8f age=1m4s\r\nAug 04 18:38:37 eth-node1 geth[968641]: INFO [08-04|18:38:37.971] Imported new block headers               count=1    elapsed=23.947ms    number=15,276,997 hash=08f7b1..7ac011\r\nAug 04 18:38:42 eth-node1 geth[968641]: INFO [08-04|18:38:42.545] State heal in progress                   accounts=2,710,573@158.35MiB slots=634,997@48.20MiB codes=120,860@935.81MiB nodes=1,571,909,964@464.06GiB pending=180,994\r\nAug 04 18:38:50 eth-node1 geth[968641]: INFO [08-04|18:38:50.619] State heal in progress                   accounts=2,710,694@158.36MiB slots=635,054@48.21MiB codes=120,860@935.81MiB nodes=1,571,910,771@464.06GiB pending=181,804\r\nAug 04 18:38:53 eth-node1 geth[968641]: INFO [08-04|18:38:53.096] Imported new block headers               count=1    elapsed=25.802ms    number=15,276,998 hash=90901c..97e30a\r\nAug 04 18:38:53 eth-node1 geth[968641]: INFO [08-04|18:38:53.552] Downloader queue stats                   receiptTasks=0   blockTasks=0   itemSize=329.68KiB throttle=796\r\nAug 04 18:38:58 eth-node1 geth[968641]: INFO [08-04|18:38:58.791] State heal in progress                   accounts=2,710,999@158.38MiB slots=635,101@48.21MiB codes=120,860@935.81MiB nodes=1,571,912,058@464.06GiB pending=182,566\r\nAug 04 18:39:02 eth-node1 geth[968641]: INFO [08-04|18:39:02.182] Imported new block headers               count=1    elapsed=32.087ms    number=15,276,999 hash=da4dd6..478f2d\r\nAug 04 18:39:02 eth-node1 geth[968641]: WARN [08-04|18:39:02.560] Pivot became stale, moving               old=15,276,873 new=15,276,937\r\nAug 04 18:39:03 eth-node1 geth[968641]: INFO [08-04|18:39:03.460] Imported new block receipts              count=64   elapsed=893.159ms   number=15,276,936 hash=433146..07dffc age=15m2s     size=9.71MiB\r\nAug 04 18:39:04 eth-node1 geth[968641]: WARN [08-04|18:39:04.217] Unexpected trienode heal packet          peer=a96cd7fd reqid=6,982,111,323,957,963,683\r\nAug 04 18:39:04 eth-node1 geth[968641]: INFO [08-04|18:39:04.217] State heal in progress                   accounts=2,711,311@158.40MiB slots=635,121@48.21MiB codes=120,860@935.81MiB nodes=1,571,913,067@464.06GiB pending=182,952\r\n```\r\n\r\n```\r\n~$ date\r\nThu Aug  4 18:40:36 CEST 2022\r\n~$ geth attach http://127.0.0.1:8545\r\nWelcome to the Geth JavaScript console!\r\n\r\ninstance: Geth/xxxx/v1.10.21-stable-67109427/linux-amd64/go1.18.4\r\nat block: 0 (Thu Jan 01 1970 01:00:00 GMT+0100 (CET))\r\n datadir: /var/lib/goethereum\r\n modules: admin:1.0 eth:1.0 net:1.0 rpc:1.0 web3:1.0\r\n\r\nTo exit, press ctrl-d or type exit\r\n> eth.syncing\r\n{\r\n  currentBlock: 15276936,\r\n  healedBytecodeBytes: 981266211,\r\n  healedBytecodes: 120860,\r\n  healedTrienodeBytes: 498289494317,\r\n  healedTrienodes: 1571927631,\r\n  healingBytecode: 0,\r\n  healingTrienodes: 1733,\r\n  highestBlock: 15277003,\r\n  startingBlock: 15252219,\r\n  syncedAccountBytes: 35196561409,\r\n  syncedAccounts: 149821236,\r\n  syncedBytecodeBytes: 2419305436,\r\n  syncedBytecodes: 429905,\r\n  syncedStorage: 496909118,\r\n  syncedStorageBytes: 106873240256\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1205508500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1205969928",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25454#issuecomment-1205969928",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25454",
    "id": 1205969928,
    "node_id": "IC_kwDOAOvK985H4aQI",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-05T02:24:51Z",
    "updated_at": "2022-08-05T02:24:51Z",
    "author_association": "MEMBER",
    "body": "> Aug 04 18:38:34 eth-node1 geth[968641]: INFO [08-04|18:38:34.137] State heal in progress                   accounts=2,710,503@158.35MiB slots=634,965@48.20MiB codes=120,860@935.81MiB nodes=1,571,909,272@464.06GiB pending=180,059\r\n\r\nYes, your node is still healing, not synced yet.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1205969928/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
